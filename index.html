<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>AI Dali Emploi CEM</title>
<style>
  body { background: #1e1e1e; color: #fff; font-family: Arial, sans-serif; direction: rtl; }
  h1 { text-align: center; }
  table { border-collapse: collapse; width: 100%; margin: 10px 0; }
  th, td { border: 1px solid #444; padding: 5px; text-align: center; }
  th { background: #333; }
  .btn { padding: 8px 15px; margin: 5px; cursor: pointer; border: none; border-radius: 5px; }
  .btn-generate { background: #4caf50; color: #fff; }
  .btn-reset { background: #f44336; color: #fff; }
  .btn-profile { background: #2196f3; color: #fff; }
  input[type="text"], input[type="number"] { width: 100%; }
  .material { font-weight: bold; padding:2px; border-radius:3px; display:block; margin:1px 0; }
</style>
</head>
<body>

<h1>AI Dali Emploi CEM - خوارزمية ذكية</h1>

<!-- رفع صورة البروفيل -->
<div>
  <label>صورتك الشخصية: </label>
  <input type="file" id="profilePic" accept="image/*">
  <img id="profilePreview" src="" style="width:50px; height:50px; border-radius:50%; vertical-align: middle;">
</div>

<!-- جدول مدخلات الأساتذة -->
<h2>مدخلات الأساتذة</h2>
<table id="teachersTable">
  <thead>
    <tr>
      <th>الاسم</th>
      <th>المادة</th>
      <th>الأقسام الممسوكة</th>
      <th>عدد الساعات الكلي</th>
      <th>حذف</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>
<button class="btn btn-profile" onclick="addTeacherRow()">إضافة أستاذ جديد</button>

<!-- جدول الأقسام -->
<h2>جدول الأقسام</h2>
<table id="sectionsTable">
  <thead>
    <tr>
      <th>المستوى</th>
      <th>عدد الأقسام</th>
    </tr>
  </thead>
  <tbody>
    <tr><td>السنة الأولى</td><td><input type="number" value="5" min="1" id="lvl1"></td></tr>
    <tr><td>السنة الثانية</td><td><input type="number" value="4" min="1" id="lvl2"></td></tr>
    <tr><td>السنة الثالثة</td><td><input type="number" value="3" min="1" id="lvl3"></td></tr>
    <tr><td>السنة الرابعة</td><td><input type="number" value="2" min="1" id="lvl4"></td></tr>
  </tbody>
</table>

<!-- أزرار التوليد -->
<button class="btn btn-generate" onclick="generateAll()">مؤسستي</button>
<button class="btn btn-reset" onclick="resetAll()">إعادة تعيين</button>

<!-- الجداول الناتجة -->
<h2>جدول المؤسسة</h2>
<div id="schoolTable"></div>

<h2>جداول الأساتذة</h2>
<div id="teachersSchedules"></div>

<h2>جداول التلاميذ</h2>
<div id="studentsSchedules"></div>

<script>
// بيانات افتراضية
let teachers = [
  {name:'دالي', subject:'رياضيات', sections:['1م1','1م2','1م3'], hours:6},
  {name:'أحمد', subject:'عربية', sections:['2م1','2م2','2م3'], hours:6},
  {name:'سعيد', subject:'فرنسية', sections:['3م1','3م2'], hours:4},
  {name:'ليلى', subject:'علوم', sections:['1م1','2م1'], hours:4},
  {name:'محمد', subject:'تاريخ', sections:['1م1','1م2'], hours:2},
  // أضف باقي الأساتذة ليصبح العدد 27 عند الحاجة
];

// ألوان المواد
const subjectColors = {
  'رياضيات':'#ff9999', 'عربية':'#99ccff', 'فرنسية':'#ffcc99',
  'علوم':'#ccff99', 'تاريخ':'#cc99ff', 'تربية اسلامية':'#ffccff',
  'تربية مدنية':'#ffff99', 'إعلام الي':'#99ffff'
};

// توزيع ساعات المواد في الجزائر (متوسط)
const subjectWeeklyHours = {
  'رياضيات':5, 'عربية':5, 'فرنسية':3, 'علوم':2,
  'تاريخ':2, 'تربية اسلامية':1, 'تربية مدنية':1, 'إعلام الي':2
};

function addTeacherRow() {
  let tbody = document.querySelector("#teachersTable tbody");
  let tr = document.createElement("tr");
  tr.innerHTML = `<td><input type="text" value=""></td>
                  <td><input type="text" value=""></td>
                  <td><input type="text" value=""></td>
                  <td><input type="number" value="0" min="0" max="20"></td>
                  <td><button onclick="this.closest('tr').remove()">حذف</button></td>`;
  tbody.appendChild(tr);
}

function resetAll() {
  document.querySelector("#teachersTable tbody").innerHTML = '';
  document.getElementById("schoolTable").innerHTML = '';
  document.getElementById("teachersSchedules").innerHTML = '';
  document.getElementById("studentsSchedules").innerHTML = '';
}

function generateAll() {
  // اقرأ البيانات من الجدول
  let tbody = document.querySelector("#teachersTable tbody");
  teachers = [];
  tbody.querySelectorAll("tr").forEach(tr=>{
    let tds = tr.querySelectorAll("td input");
    if(tds[0].value && tds[1].value){
      let sections = tds[2].value.split(',').map(s=>s.trim()).filter(s=>s);
      teachers.push({name: tds[0].value, subject: tds[1].value, sections: sections, hours: parseInt(tds[3].value)});
    }
  });
  
  generateSchoolTable();
  generateTeachersSchedules();
  generateStudentsSchedules();
}

// توليد جدول المؤسسة مع خوارزمية ذكية
function generateSchoolTable() {
  let div = document.getElementById("schoolTable");
  div.innerHTML = '';
  let table = document.createElement('table');
  let sections = [];
  let lvl1 = parseInt(document.getElementById('lvl1').value);
  let lvl2 = parseInt(document.getElementById('lvl2').value);
  let lvl3 = parseInt(document.getElementById('lvl3').value);
  let lvl4 = parseInt(document.getElementById('lvl4').value);
  for(let i=1;i<=lvl1;i++) sections.push(`1م${i}`);
  for(let i=1;i<=lvl2;i++) sections.push(`2م${i}`);
  for(let i=1;i<=lvl3;i++) sections.push(`3م${i}`);
  for(let i=1;i<=lvl4;i++) sections.push(`4م${i}`);
  
  let days = ['الأحد','الإثنين','الثلاثاء','الأربعاء','الخميس'];
  let maxHours = 7; // ساعات يومية
  
  // رأس الجدول
  let trHead = document.createElement('tr');
  trHead.innerHTML = '<th>اليوم/الساعة</th>';
  sections.forEach(s=> trHead.innerHTML += `<th>${s}</th>`);
  table.appendChild(trHead);
  
  days.forEach(day=>{
    for(let h=1; h<=maxHours; h++){
      let tr = document.createElement('tr');
      tr.innerHTML = `<td>${day} - الحصة ${h}</td>`;
      sections.forEach(sec=>{
        let cellContent = '';
        // اختيار أستاذ حسب المادة وعدد الأقسام
        let availableTeachers = teachers.filter(t=>t.sections.includes(sec));
        if(availableTeachers.length>0){
          let tIndex = Math.floor(Math.random()*availableTeachers.length);
          let t = availableTeachers[tIndex];
          cellContent = `<div class="material" style="background:${subjectColors[t.subject]}">${t.subject}</div>`;
        }
        tr.innerHTML += `<td>${cellContent}</td>`;
      });
      table.appendChild(tr);
    }
  });
  div.appendChild(table);
}

// جداول الأساتذة
function generateTeachersSchedules() {
  let div = document.getElementById("teachersSchedules");
  div.innerHTML = '';
  teachers.forEach(t=>{
    let table = document.createElement('table');
    table.innerHTML = `<thead><tr><th colspan="6">${t.name} - ${t.subject}</th></tr><tr><th>اليوم</th><th colspan="5">الأقسام</th></tr></thead>`;
    let days = ['الأحد','الإثنين','الثلاثاء','الأربعاء','الخميس'];
    days.forEach(day=>{
      let tr = document.createElement('tr');
      tr.innerHTML = `<td>${day}</td>`;
      tr.innerHTML += `<td colspan="5" style="background:${subjectColors[t.subject]}">حصة ${t.subject} ${t.sections.join(',')}</td>`;
      table.appendChild(tr);
    });
    div.appendChild(table);
  });
}

// جداول التلاميذ
function generateStudentsSchedules() {
  let div = document.getElementById("studentsSchedules");
  div.innerHTML = '';
  let sections = [];
  let lvl1 = parseInt(document.getElementById('lvl1').value);
  let lvl2 = parseInt(document.getElementById('lvl2').value);
  let lvl3 = parseInt(document.getElementById('lvl3').value);
  let lvl4 = parseInt(document.getElementById('lvl4').value);
  for(let i=1;i<=lvl1;i++) sections.push(`1م${i}`);
  for(let i=1;i<=lvl2;i++) sections.push(`2م${i}`);
  for(let i=1;i<=lvl3;i++) sections.push(`3م${i}`);
  for(let i=1;i<=lvl4;i++) sections.push(`4م${i}`);
  
  sections.forEach(sec=>{
    let table = document.createElement('table');
    table.innerHTML = `<thead><tr><th colspan="6">${sec}</th></tr><tr><th>اليوم</th><th>المادة</th><th>نوع الحصة</th><th colspan="3"></th></tr></thead>`;
    let days = ['الأحد','الإثنين','الثلاثاء','الأربعاء','الخميس'];
    days.forEach(day=>{
      for(let h=1; h<=7; h++){
        let tr = document.createElement('tr');
        tr.innerHTML = `<td>${day} - الحصة ${h}</td>`;
        let t = teachers.find(t=>t.sections.includes(sec));
        if(t){
          let type = 'درس';
          // اعمال موجهة لكل مادة أساسية
          if(['رياضيات','عربية','فرنسية'].includes(t.subject) && h===7) type='أعمال موجهة';
          tr.innerHTML += `<td>${t.subject}</td><td>${type}</td><td colspan="3" style="background:${subjectColors[t.subject]}"></td>`;
        } else {
          tr.innerHTML += `<td>---</td><td>---</td><td colspan="3"></td>`;
        }
        table.appendChild(tr);
      }
    });
    div.appendChild(table);
  });
}

// عرض صورة البروفيل
document.getElementById("profilePic").addEventListener("change", function(e){
  const file = e.target.files[0];
  if(file){
    const reader = new FileReader();
    reader.onload = function(evt){ document.getElementById("profilePreview").src = evt.target.result; };
    reader.readAsDataURL(file);
  }
});
</script>
</body>
</html>
