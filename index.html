<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>AI Dali Emploi CEM</title>
<style>
  body {
    background-color: #111;
    color: #eee;
    font-family: "Arial", sans-serif;
    margin: 0;
    padding: 0;
  }
  header {
    background-color: #222;
    padding: 10px;
    text-align: center;
  }
  h1 {
    margin: 0;
    color: #ffcc00;
  }
  .container {
    padding: 10px 20px;
  }
  table {
    border-collapse: collapse;
    width: 100%;
    margin-bottom: 20px;
  }
  table, th, td {
    border: 1px solid #555;
  }
  th, td {
    padding: 5px;
    text-align: center;
  }
  th {
    background-color: #333;
    color: #ffcc00;
  }
  .btn {
    padding: 8px 15px;
    margin: 5px;
    cursor: pointer;
    border: none;
    border-radius: 5px;
    color: #fff;
  }
  .btn-generate { background-color: #28a745; }
  .btn-reset { background-color: #dc3545; }
  .btn-pdf { background-color: #007bff; }
  .btn-word { background-color: #6f42c1; }
  .btn-print { background-color: #17a2b8; }
  .profile {
    float: left;
    margin-right: 10px;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    object-fit: cover;
  }
  input, select {
    padding: 5px;
    margin: 2px;
  }
  .flex-row {
    display: flex;
    align-items: center;
    margin-bottom: 10px;
  }
</style>
</head>
<body>

<header>
  <img src="" id="profilePic" class="profile" alt="صورة البروفايل">
  <h1>AI Dali Emploi CEM</h1>
</header>

<div class="container">

  <div class="flex-row">
    <button class="btn btn-generate" onclick="fillSchoolData()">مؤسستي</button>
    <button class="btn btn-generate" onclick="generateAll()">توليد الجداول</button>
    <button class="btn btn-reset" onclick="resetAll()">إعادة تعيين</button>
    <button class="btn btn-pdf" onclick="downloadPDF()">تحميل PDF</button>
    <button class="btn btn-word" onclick="downloadWord()">تحميل Word</button>
    <button class="btn btn-print" onclick="window.print()">طباعة</button>
    <input type="file" id="profileUpload" accept="image/*" onchange="loadProfile(event)">
  </div>

  <h2>مدخلات الأساتذة</h2>
  <table id="teacherInputTable">
    <thead>
      <tr>
        <th>الاسم</th>
        <th>المادة</th>
        <th>الأقسام المسندة</th>
        <th>عدد الساعات الكلي</th>
        <th>تعديل / حذف</th>
      </tr>
    </thead>
    <tbody>
    </tbody>
  </table>
  <button class="btn btn-generate" onclick="addTeacher()">إضافة أستاذ جديد</button>

  <h2>مدخلات الأقسام</h2>
  <table id="classInputTable">
    <thead>
      <tr>
        <th>المستوى</th>
        <th>عدد الأقسام</th>
      </tr>
    </thead>
    <tbody>
      <tr><td>السنة الأولى</td><td><input type="number" value="5" min="1"></td></tr>
      <tr><td>السنة الثانية</td><td><input type="number" value="4" min="1"></td></tr>
      <tr><td>السنة الثالثة</td><td><input type="number" value="3" min="1"></td></tr>
      <tr><td>السنة الرابعة</td><td><input type="number" value="2" min="1"></td></tr>
    </tbody>
  </table>

  <h2>جداول الأساتذة</h2>
  <div id="teacherTables"></div>

  <h2>جداول التلاميذ</h2>
  <div id="studentTables"></div>

  <h2>جدول المؤسسة</h2>
  <div id="schoolTable"></div>

</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
  // مصفوفة لتخزين الأساتذة
  let teachers = [];
  let profileImage = '';

  function loadProfile(event) {
    const reader = new FileReader();
    reader.onload = function(){
      profileImage = reader.result;
      document.getElementById('profilePic').src = profileImage;
    };
    reader.readAsDataURL(event.target.files[0]);
  }

  function addTeacher(name='أستاذ افتراضي', subject='رياضيات', classes=['1A','1B'], hours=6) {
    const teacher = {name, subject, classes, hours};
    teachers.push(teacher);
    renderTeacherInputs();
  }

  function renderTeacherInputs() {
    const tbody = document.querySelector("#teacherInputTable tbody");
    tbody.innerHTML = '';
    teachers.forEach((t, i) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `<td contenteditable="true">${t.name}</td>
                      <td contenteditable="true">${t.subject}</td>
                      <td contenteditable="true">${t.classes.join(', ')}</td>
                      <td contenteditable="true">${t.hours}</td>
                      <td>
                        <button onclick="deleteTeacher(${i})">حذف</button>
                      </td>`;
      tbody.appendChild(tr);
    });
  }

  function deleteTeacher(index) {
    teachers.splice(index,1);
    renderTeacherInputs();
  }

  function fillSchoolData() {
    teachers = [];
    const defaultNames = Array.from({length:27},(_,i)=>`أستاذ ${i+1}`);
    const subjects = ['رياضيات','عربية','فرنسية','إنجليزية','علوم','فيزياء','تاريخ','جغرافيا','إعلام آلي','تربية إسلامية','تربية مدنية','رسم','موسيقى'];
    for(let i=0;i<27;i++){
      let classes = [];
      if(i<5) classes=['1A','1B'];
      else if(i<10) classes=['2A','2B'];
      else if(i<15) classes=['3A','3B'];
      else classes=['4A'];
      let hours = Math.floor(Math.random()*5)+4; // ساعات واقعية 4-8
      teachers.push({name: defaultNames[i], subject: subjects[i%subjects.length], classes, hours});
    }
    renderTeacherInputs();
    alert('تم ملء بيانات المؤسسة افتراضياً');
  }

  function resetAll() {
    teachers=[];
    renderTeacherInputs();
    document.getElementById('teacherTables').innerHTML='';
    document.getElementById('studentTables').innerHTML='';
    document.getElementById('schoolTable').innerHTML='';
    alert('تم إعادة التعيين للملء اليدوي');
  }

  // خوارزمية توليد الجداول مترابطة
  function generateAll() {
    generateTeacherTables();
    generateStudentTables();
    generateSchoolTable();
  }

  function generateTeacherTables() {
    const container = document.getElementById('teacherTables');
    container.innerHTML='';
    teachers.forEach(t=>{
      const table = document.createElement('table');
      const th = document.createElement('tr');
      th.innerHTML='<th>اليوم</th>';
      for(let i=1;i<=t.classes.length;i++) th.innerHTML+=`<th>حصة ${i}</th>`;
      table.appendChild(th);
      const days = ['الأحد','الإثنين','الثلاثاء','الأربعاء','الخميس'];
      days.forEach(day=>{
        const tr = document.createElement('tr');
        tr.innerHTML=`<td>${day}</td>`;
        t.classes.forEach(c=>{
          tr.innerHTML+=`<td>${t.subject}</td>`;
        });
        table.appendChild(tr);
      });
      container.appendChild(table);
    });
  }

  function generateStudentTables() {
    const container = document.getElementById('studentTables');
    container.innerHTML='';
    const levels = ['السنة الأولى','السنة الثانية','السنة الثالثة','السنة الرابعة'];
    levels.forEach(l=>{
      const table = document.createElement('table');
      const th = document.createElement('tr');
      th.innerHTML='<th>اليوم</th>';
      for(let i=1;i<=5;i++) th.innerHTML+=`<th>حصة ${i}</th>`;
      table.appendChild(th);
      const days = ['الأحد','الإثنين','الثلاثاء','الأربعاء','الخميس'];
      days.forEach(day=>{
        const tr = document.createElement('tr');
        tr.innerHTML=`<td>${day}</td>`;
        for(let i=0;i<5;i++){
          tr.innerHTML+=`<td>مادة ${i+1}</td>`;
        }
        table.appendChild(tr);
      });
      container.appendChild(table);
    });
  }

  function generateSchoolTable() {
    const container = document.getElementById('schoolTable');
    container.innerHTML='';
    const table = document.createElement('table');
    const th = document.createElement('tr');
    th.innerHTML='<th>اليوم</th>';
    const levels = ['1','2','3','4','5','6','7','8','9','10','11','12','13'];
    levels.forEach(l=>th.innerHTML+=`<th>قسم ${l}</th>`);
    table.appendChild(th);
    const days = ['الأحد','الإثنين','الثلاثاء','الأربعاء','الخميس'];
    days.forEach(day=>{
      const tr = document.createElement('tr');
      tr.innerHTML=`<td>${day}</td>`;
      levels.forEach(l=>{
        tr.innerHTML+=`<td>مادة</td>`;
      });
      table.appendChild(tr);
    });
    container.appendChild(table);
  }

  function downloadPDF() {
    alert('تحميل PDF سيتم تطويره لاحقاً');
  }

  function downloadWord() {
    alert('تحميل Word سيتم تطويره لاحقاً');
  }
</script>
</body>
</html>
