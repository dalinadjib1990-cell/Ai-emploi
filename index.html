<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>AI Dali Emploi â€” Ù…ÙˆÙ„Ø¯ Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ø§Ù„Ø²Ù…Ù† (Ù†Ø³Ø®Ø© Ù…ØªÙ‚Ø¯Ù…Ø©)</title>
<style>
  :root{
    --bg:#071018; --card:#0f1720; --accent:#5D5CDE; --muted:#94a3b8;
    --official:#90EE90; --remedial:#FFFF99; --project:#66c66b; --free:#ffffff; --break:#e2e8f0;
  }
  body{margin:0;font-family:"Segoe UI",Tahoma,Arial;background:var(--bg);color:#fff;direction:rtl}
  .wrap{max-width:1200px;margin:18px auto;padding:16px}
  header{display:flex;align-items:center;justify-content:space-between;gap:10px}
  h1{margin:0;font-size:20px;color:var(--accent)}
  .controls{display:flex;gap:8px;flex-wrap:wrap}
  button{background:var(--accent);color:#fff;border:none;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:600}
  button.ghost{background:#15303b}
  .grid{display:grid;grid-template-columns:1fr 360px;gap:16px;margin-top:14px}
  .card{background:var(--card);padding:12px;border-radius:10px;box-shadow:0 6px 20px rgba(0,0,0,.6)}
  label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
  input[type="number"],input[type="text"],select,textarea{width:100%;padding:8px;border-radius:8px;border:none;background:#071824;color:#fff}
  table{width:100%;border-collapse:collapse;font-size:13px}
  th,td{border:1px solid #123040;padding:6px;text-align:center}
  th{background:#071829}
  .small{font-size:12px;color:var(--muted)}
  .avatar{width:72px;height:72px;border-radius:50%;object-fit:cover;border:3px solid #fff}
  .top-right{display:flex;flex-direction:column;align-items:flex-end;gap:6px}
  .legend{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  .legend span{padding:6px 10px;border-radius:6px;font-weight:700;color:#000}
  .official{background:var(--official)}
  .remedial{background:var(--remedial)}
  .project{background:var(--project)}
  .free{background:var(--free)}
  .break{background:var(--break)}
  .notice{color:#fca5a5;font-weight:700;margin-top:8px}
  .tabBtns{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
  .tabBtn{padding:8px 10px;border-radius:8px;background:#0b1220;color:var(--muted);cursor:pointer;border:1px solid #123040}
  .tabBtn.active{background:var(--accent);color:#fff}
  .outputArea{margin-top:12px}
  .card h3{margin:0 0 8px 0}
  .schedule-table{border-collapse:collapse;width:100%;margin:10px 0;background:#021018}
  .schedule-table th,.schedule-table td{border:1px solid #123040;padding:6px;text-align:center;color:#000;background:#fff}
  .slot{min-width:120px}
  @media(max-width:960px){.grid{grid-template-columns:1fr}}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>AI Dali Emploi â€” Ù…ÙˆÙ„Ø¯ Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ø§Ù„Ø²Ù…Ù† (Ù…ØªÙ‚Ø¯Ù…)</h1>
        <div class="small">Ø§Ø¶ØºØ· "Ù…Ø¤Ø³Ø³ØªÙŠ" Ù„Ù…Ù„Ø¡ Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ù…ÙˆØ°Ø¬ÙŠØ© Ø«Ù… "ØªÙˆÙ„ÙŠØ¯" Ù„Ø¥Ù†ØªØ§Ø¬ Ø¬Ø¯Ø§ÙˆÙ„. ÙƒÙ„ ØªÙˆÙ„ÙŠØ¯ ÙŠØ¹Ø·ÙŠ Ø§Ø­ØªÙ…Ø§Ù„Ø§ Ø¬Ø¯ÙŠØ¯Ø§.</div>
      </div>

      <div class="top-right">
        <div style="display:flex;gap:8px;align-items:center">
          <input id="imgInput" type="file" accept="image/*" style="display:none" onchange="loadAvatar(event)">
          <img id="avatar" class="avatar" src="" alt="avatar" onerror="this.style.display='none'">
          <div style="min-width:120px">
            <button class="ghost" onclick="document.getElementById('imgInput').click()">ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©</button>
            <div class="small">ØµÙˆØ±Ø© Ø¨Ø±ÙˆÙØ§ÙŠÙ„</div>
          </div>
        </div>
        <div class="small">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ØªØ¬Ø±ÙŠØ¨ÙŠ</div>
      </div>
    </header>

    <div class="grid">
      <!-- LEFT: setup -->
      <div>
        <div class="card">
          <h3>1. Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø¤Ø³Ø³Ø©</h3>
          <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø¤Ø³Ø³Ø©</label>
          <input id="institutionName" type="text" placeholder="Ù…Ø«Ø§Ù„: Ù…ØªÙˆØ³Ø·Ø© Ù„Ø§Ø±Ø§">
          <div style="display:flex;gap:8px;margin-top:8px">
            <div style="flex:1">
              <label>Ø³Ù†Ø© 1Ù… - Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</label>
              <input id="lvl1" type="number" min="0" value="5" onchange="updateTotal()">
            </div>
            <div style="flex:1">
              <label>Ø³Ù†Ø© 2Ù… - Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</label>
              <input id="lvl2" type="number" min="0" value="3" onchange="updateTotal()">
            </div>
            <div style="flex:1">
              <label>Ø³Ù†Ø© 3Ù… - Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</label>
              <input id="lvl3" type="number" min="0" value="3" onchange="updateTotal()">
            </div>
            <div style="flex:1">
              <label>Ø³Ù†Ø© 4Ù… - Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</label>
              <input id="lvl4" type="number" min="0" value="2" onchange="updateTotal()">
            </div>
          </div>
          <div style="margin-top:8px"><strong>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…:</strong> <span id="totalClasses">13</span></div>
        </div>

        <div class="card" style="margin-top:12px">
          <h3>2. Ø¥Ø¶Ø§ÙØ© Ø£Ø³Ø§ØªØ°Ø© (Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ)</h3>
          <div style="display:flex;gap:8px;align-items:center">
            <input id="tName" type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ø£Ø³ØªØ§Ø°">
            <select id="tSubject">
              <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø¯Ø©</option>
              <option>Ø±ÙŠØ§Ø¶ÙŠØ§Øª</option><option>Ø¹Ø±Ø¨ÙŠØ©</option><option>ÙØ±Ù†Ø³ÙŠØ©</option><option>Ø§Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</option>
              <option>ØªØ§Ø±ÙŠØ® ÙˆØ¬ØºØ±Ø§ÙÙŠØ§</option><option>ØªØ±Ø¨ÙŠØ© Ù…Ø¯Ù†ÙŠØ©</option><option>Ø¹Ù„ÙˆÙ… Ø·Ø¨ÙŠØ¹ÙŠØ©</option>
              <option>ÙÙŠØ²ÙŠØ§Ø¡</option><option>ØªØ±Ø¨ÙŠØ© Ø§Ø³Ù„Ø§Ù…ÙŠØ©</option><option>Ø±ÙŠØ§Ø¶Ø©</option>
              <option>Ø¥Ø¹Ù„Ø§Ù… Ø¢Ù„ÙŠ</option><option>Ø±Ø³Ù…</option>
            </select>
          </div>
          <div style="display:flex;gap:8px;margin-top:8px">
            <input id="tSections" type="text" placeholder="Ø§Ù„Ø£Ù‚Ø³Ø§Ù… (Ù…Ø«Ø§Ù„: 4Ù…1,3Ù…2)" />
            <input id="tHours" type="number" min="1" max="20" placeholder="Ø³Ø§Ø¹Ø§Øª/Ø£Ø³Ø¨ÙˆØ¹" style="width:120px" />
            <button onclick="addTeacher()" style="background:#10b981;padding:8px 10px;border-radius:8px">Ø¥Ø¶Ø§ÙØ©</button>
          </div>

          <div style="margin-top:12px;max-height:240px;overflow:auto">
            <table id="teachersTable">
              <thead><tr><th>Ø§Ù„Ø£Ø³ØªØ§Ø°</th><th>Ø§Ù„Ù…Ø§Ø¯Ø©</th><th>Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</th><th>Ø³Ø§Ø¹Ø§Øª</th><th>Ø­Ø°Ù</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <div style="display:flex;gap:8px;margin-top:12px;flex-wrap:wrap">
          <button onclick="loadMyCEM()">ğŸ« Ù…Ø¤Ø³Ø³ØªÙŠ (ØªØ­Ù…ÙŠÙ„ Ø§ÙØªØ±Ø§Ø¶ÙŠ)</button>
          <button onclick="resetAll()" class="ghost">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†</button>
          <button onclick="generateAll()" style="background:#06b6d4">âš¡ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„</button>
          <button onclick="copyOutput()" class="ghost">ğŸ“‹ Ù†Ø³Ø®</button>
          <button onclick="exportPDF()" class="ghost">ğŸ“„ PDF</button>
        </div>

        <div class="card" style="margin-top:12px">
          <div class="legend">
            <span class="official">Ø­ØµØ© Ø±Ø³Ù…ÙŠØ©</span>
            <span class="remedial">Ø§Ø³ØªØ¯Ø±Ø§Ùƒ</span>
            <span class="project">Ø£Ø¹Ù…Ø§Ù„ Ù…ÙˆØ¬Ù‡Ø©</span>
            <span class="free">ÙØ±Ø§Øº</span>
            <span class="break">Ø§Ø³ØªØ±Ø§Ø­Ø©</span>
          </div>
          <div class="notice">Ø§Ù„Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© ØªØ­ØªØ±Ù… Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ø¨ÙŠØ¯Ø§ØºÙˆØ¬ÙŠØ© ÙˆØ§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø±Ø³Ù…ÙŠØ© ÙˆØªÙØ¶Ù„ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª ØµØ¨Ø§Ø­Ù‹Ø§.</div>
        </div>
      </div>

      <!-- RIGHT: quick info -->
      <div>
        <div class="card">
          <h3>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h3>
          <div><strong>Ø£ÙŠØ§Ù… Ø§Ù„Ø¹Ù…Ù„:</strong> Ø§Ù„Ø£Ø­Ø¯ØŒ Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†ØŒ Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡ (Ù†ØµÙ ÙŠÙˆÙ…)ØŒ Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡ØŒ Ø§Ù„Ø®Ù…ÙŠØ³</div>
          <div><strong>Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø±Ø³Ù…ÙŠØ©:</strong> 08:00-15:00 (Ø±Ø§Ø­Ø© 12:00-13:00)</div>
          <div><strong>Ø³Ø§Ø¹Ø§Øª Ø§Ø³ØªØ¯Ø±Ø§Ùƒ:</strong> 15:00-16:00 (Ø§Ø®ØªÙŠØ§Ø±ÙŠØ©)</div>
        </div>

        <div class="card" style="margin-top:12px">
          <h3>Ø£ÙŠØ§Ù… Ø¨ÙŠØ¯Ø§ØºÙˆØ¬ÙŠØ© (Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„)</h3>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
            <label>Ø±ÙŠØ§Ø¶ÙŠØ§Øª<select id="pdMath"><option>Ø§Ù„Ø®Ù…ÙŠØ³</option><option>Ø§Ù„Ø¬Ù…Ø¹Ø©</option></select></label>
            <label>Ø¹Ø±Ø¨ÙŠØ©<select id="pdArabic"><option>Ø§Ù„Ø§Ø«Ù†ÙŠÙ†</option></select></label>
            <label>ÙØ±Ù†Ø³ÙŠØ©<select id="pdFrench"><option>Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡</option></select></label>
            <label>Ø§Ù†Ø¬Ù„ÙŠØ²ÙŠØ©<select id="pdEng"><option>Ø§Ù„Ø§Ø«Ù†ÙŠÙ†</option></select></label>
            <label>Ø¹Ù„ÙˆÙ…<select id="pdSci"><option>Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡</option></select></label>
            <label>ÙÙŠØ²ÙŠØ§Ø¡<select id="pdPhy"><option>Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡</option></select></label>
          </div>
        </div>

      </div>
    </div>

    <!-- OUTPUT -->
    <div id="outputArea" style="margin-top:18px"></div>
  </div>

<!-- Scripting -->
<script>
/* ===== data structures and defaults ===== */
const DAYS = ['Ø§Ù„Ø£Ø­Ø¯','Ø§Ù„Ø§Ø«Ù†ÙŠÙ†','Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡','Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡','Ø§Ù„Ø®Ù…ÙŠØ³'];
// SLOTS morning+afternoon + remedial
const SLOTS = ['08:00-09:00','09:00-10:00','10:00-11:00','11:00-12:00','13:00-14:00','14:00-15:00','15:00-16:00'];
const BREAK_SLOT = '12:00-13:00';
const MAX_TEACHER = 20;

// subject weekly hours per level (1..4)
const subjHours = {
  'Ø±ÙŠØ§Ø¶ÙŠØ§Øª':{'1':4,'2':4,'3':5,'4':5},
  'Ø¹Ø±Ø¨ÙŠØ©':{'1':4,'2':4,'3':4,'4':4},
  'ÙØ±Ù†Ø³ÙŠØ©':{'1':3,'2':3,'3':3,'4':3},
  'Ø§Ù†Ø¬Ù„ÙŠØ²ÙŠØ©':{'1':3,'2':3,'3':3,'4':3},
  'Ø¹Ù„ÙˆÙ… Ø·Ø¨ÙŠØ¹ÙŠØ©':{'1':3,'2':3,'3':3,'4':3},
  'ÙÙŠØ²ÙŠØ§Ø¡':{'1':2,'2':2,'3':2,'4':2},
  'ØªØ§Ø±ÙŠØ® ÙˆØ¬ØºØ±Ø§ÙÙŠØ§':{'1':2,'2':2,'3':2,'4':2},
  'ØªØ±Ø¨ÙŠØ© Ù…Ø¯Ù†ÙŠØ©':{'1':1,'2':1,'3':1,'4':1},
  'ØªØ±Ø¨ÙŠØ© Ø§Ø³Ù„Ø§Ù…ÙŠØ©':{'1':2,'2':2,'3':2,'4':2},
  'Ø±ÙŠØ§Ø¶Ø©':{'1':2,'2':2,'3':2,'4':2},
  'Ø¥Ø¹Ù„Ø§Ù… Ø¢Ù„ÙŠ':{'1':1,'2':1,'3':1,'4':0},
  'Ø±Ø³Ù…':{'1':1,'2':1,'3':1,'4':1}
};

// default pedagogical days (can be overridden by selects later)
let pedagogical = {
  'Ø±ÙŠØ§Ø¶ÙŠØ§Øª':'Ø§Ù„Ø®Ù…ÙŠØ³','Ø¹Ø±Ø¨ÙŠØ©':'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†','ÙØ±Ù†Ø³ÙŠØ©':'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡','Ø§Ù†Ø¬Ù„ÙŠØ²ÙŠØ©':'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†',
  'ØªØ§Ø±ÙŠØ® ÙˆØ¬ØºØ±Ø§ÙÙŠØ§':'Ø§Ù„Ø£Ø­Ø¯','ØªØ±Ø¨ÙŠØ© Ù…Ø¯Ù†ÙŠØ©':'Ø§Ù„Ø£Ø­Ø¯','ØªØ±Ø¨ÙŠØ© Ø§Ø³Ù„Ø§Ù…ÙŠØ©':'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†',
  'Ø¹Ù„ÙˆÙ… Ø·Ø¨ÙŠØ¹ÙŠØ©':'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡','ÙÙŠØ²ÙŠØ§Ø¡':'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡','Ø±Ø³Ù…':'Ø§Ù„Ø®Ù…ÙŠØ³','Ø¥Ø¹Ù„Ø§Ù… Ø¢Ù„ÙŠ':'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡'
};

// teachers array
let teachers = []; // objects: {name, subject, sections:[], hours, totalAssigned}

// institution levels
let institution = { levels: {'1':5,'2':3,'3':3,'4':2}, name: '' };

/* ===== helpers for DOM ===== */
function q(sel){ return document.querySelector(sel) }
function updateTotal(){
  institution.levels['1'] = parseInt(q('#lvl1').value||0);
  institution.levels['2'] = parseInt(q('#lvl2').value||0);
  institution.levels['3'] = parseInt(q('#lvl3').value||0);
  institution.levels['4'] = parseInt(q('#lvl4').value||0);
  const tot = Object.values(institution.levels).reduce((a,b)=>a+b,0);
  q('#totalClasses').innerText = tot;
}

/* teacher management */
function addTeacher(){
  const name = q('#tName').value.trim();
  const subj = q('#tSubject').value;
  const secsRaw = q('#tSections').value.trim();
  const hours = parseInt(q('#tHours').value) || 18;
  if(!name || !subj){ alert('Ø§Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø£Ø³ØªØ§Ø° ÙˆØ§Ù„Ù…Ø§Ø¯Ø©'); return; }
  const secs = secsRaw ? secsRaw.split(',').map(s=>s.trim()) : [];
  teachers.push({name, subject:subj, sections:secs, hours, totalAssigned:0});
  q('#tName').value=''; q('#tSections').value=''; q('#tHours').value='';
  renderTeachers();
}
function renderTeachers(){
  const tbody = q('#teachersTable tbody'); tbody.innerHTML='';
  teachers.forEach((t,i)=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${t.name}</td><td>${t.subject}</td><td>${t.sections.join(',')||'â€”'}</td><td>${t.hours}</td><td><button onclick="delTeacher(${i})">Ø­Ø°Ù</button></td>`;
    tbody.appendChild(tr);
  });
}
function delTeacher(i){ teachers.splice(i,1); renderTeachers(); }

/* avatar loader */
function loadAvatar(e){
  const f = e.target.files[0]; if(!f) return;
  const url = URL.createObjectURL(f);
  const img = q('#avatar'); img.src = url; img.style.display='block';
}

/* load sample institution (user-provided example) */
function loadMyCEM(){
  // set institution and teachers as provided earlier in chat
  resetAll();
  institution.name = 'Ù…ØªÙˆØ³Ø·Ø© Ù„Ø§Ø±Ø§ (Ù†Ù…ÙˆØ°Ø¬)';
  q('#institutionName').value = institution.name;
  q('#lvl1').value=5; q('#lvl2').value=3; q('#lvl3').value=4; q('#lvl4').value=2; updateTotal();

  // sample teachers (27) based on user's list â€” balanced example
  teachers = [
    {name:'Ù†Ø¬ÙŠØ¨',subject:'Ø±ÙŠØ§Ø¶ÙŠØ§Øª',sections:['4Ù…1','3Ù…1'],hours:20,totalAssigned:0},
    {name:'Ù…Ù†ÙŠØ±Ø©',subject:'Ø±ÙŠØ§Ø¶ÙŠØ§Øª',sections:['4Ù…2','1Ù…1'],hours:18,totalAssigned:0},
    {name:'Ø±Ù…Ø²ÙŠ',subject:'Ø±ÙŠØ§Ø¶ÙŠØ§Øª',sections:['4Ù…1','2Ù…1'],hours:18,totalAssigned:0},
    {name:'Ø£Ù…Ø§Ù„',subject:'Ø±ÙŠØ§Ø¶ÙŠØ§Øª',sections:['4Ù…2','3Ù…2'],hours:18,totalAssigned:0},

    {name:'ØµØ¨Ø±ÙŠÙ†Ø©',subject:'Ø¹Ø±Ø¨ÙŠØ©',sections:['1Ù…1','2Ù…1'],hours:18,totalAssigned:0},
    {name:'Ù…Ø±ÙˆØ©',subject:'Ø¹Ø±Ø¨ÙŠØ©',sections:['1Ù…2','3Ù…1'],hours:18,totalAssigned:0},
    {name:'Ø³Ø§Ø±Ø©',subject:'Ø¹Ø±Ø¨ÙŠØ©',sections:['1Ù…3','3Ù…2'],hours:18,totalAssigned:0},
    {name:'ÙˆØ­ÙŠØ¯',subject:'Ø¹Ø±Ø¨ÙŠØ©',sections:['2Ù…2'],hours:16,totalAssigned:0},
    {name:'Ø¹Ø§Ù…Ø±',subject:'Ø¹Ø±Ø¨ÙŠØ©',sections:['4Ù…2'],hours:16,totalAssigned:0},

    {name:'Ø§Ù„Ø¹ÙŠØ¯',subject:'ÙØ±Ù†Ø³ÙŠØ©',sections:['1Ù…1','2Ù…1'],hours:16,totalAssigned:0},
    {name:'Ø³Ù„Ù…Ù‰',subject:'ÙØ±Ù†Ø³ÙŠØ©',sections:['1Ù…2','3Ù…1'],hours:16,totalAssigned:0},
    {name:'Ø³Ø§Ø±Ø©_Ù',subject:'ÙØ±Ù†Ø³ÙŠØ©',sections:['2Ù…2'],hours:16,totalAssigned:0},

    {name:'Ø¨ÙˆØ¨ÙƒØ±',subject:'Ø§Ù†Ø¬Ù„ÙŠØ²ÙŠØ©',sections:['1Ù…1'],hours:12,totalAssigned:0},
    {name:'Ù‡Ø´Ø§Ù…',subject:'Ø§Ù†Ø¬Ù„ÙŠØ²ÙŠØ©',sections:['2Ù…1'],hours:12,totalAssigned:0},
    {name:'Ø£Ù…ÙŠÙ†Ø©_Ø§Ù†',subject:'Ø§Ù†Ø¬Ù„ÙŠØ²ÙŠØ©',sections:['3Ù…1','4Ù…1'],hours:14,totalAssigned:0},

    {name:'Ø¹Ø§Ø¦Ø´Ø©',subject:'ØªØ§Ø±ÙŠØ® ÙˆØ¬ØºØ±Ø§ÙÙŠØ§',sections:['1Ù…1','2Ù…1'],hours:12,totalAssigned:0},
    {name:'ÙØ§Ø·Ù…Ø©',subject:'ØªØ§Ø±ÙŠØ® ÙˆØ¬ØºØ±Ø§ÙÙŠØ§',sections:['3Ù…1'],hours:10,totalAssigned:0},
    {name:'Ø£Ù…Ø§Ù„_Øª',subject:'ØªØ§Ø±ÙŠØ® ÙˆØ¬ØºØ±Ø§ÙÙŠØ§',sections:['4Ù…1'],hours:10,totalAssigned:0},

    {name:'ÙˆØ³ÙŠÙ„Ø©',subject:'Ø¹Ù„ÙˆÙ… Ø·Ø¨ÙŠØ¹ÙŠØ©',sections:['1Ù…1','2Ù…1'],hours:12,totalAssigned:0},
    {name:'Ø·Ø§ÙˆØ³',subject:'Ø¹Ù„ÙˆÙ… Ø·Ø¨ÙŠØ¹ÙŠØ©',sections:['3Ù…1','4Ù…1'],hours:12,totalAssigned:0},

    {name:'Ø¹Ø¨Ø¯ Ø§Ù„Ø±Ø²Ø§Ù‚',subject:'ÙÙŠØ²ÙŠØ§Ø¡',sections:['4Ù…1','4Ù…2'],hours:12,totalAssigned:0},
    {name:'Ø£Ù…ÙŠÙ†Ø©_ÙÙŠ',subject:'ÙÙŠØ²ÙŠØ§Ø¡',sections:['3Ù…2'],hours:10,totalAssigned:0},

    {name:'Ø¹Ù„Ø§Ø¡',subject:'Ø±ÙŠØ§Ø¶Ø©',sections:['1Ù…1','2Ù…1'],hours:8,totalAssigned:0},
    {name:'Ø³Ù…ÙŠØ±',subject:'Ø±ÙŠØ§Ø¶Ø©',sections:['3Ù…1','4Ù…2'],hours:8,totalAssigned:0},

    {name:'Ø³Ø¹ÙŠØ¯',subject:'Ø±Ø³Ù…',sections:['4Ù…1','4Ù…2'],hours:6,totalAssigned:0},
    {name:'Ø£Ù…ÙŠÙ†Ø©_Ø§Ø¹Ù„Ø§Ù…',subject:'Ø¥Ø¹Ù„Ø§Ù… Ø¢Ù„ÙŠ',sections:['1Ù…1','2Ù…1'],hours:6,totalAssigned:0},
    {name:'Ù…Ø¹Ù„Ù…_Ø§Ø³Ù„Ø§Ù…ÙŠ',subject:'ØªØ±Ø¨ÙŠØ© Ø§Ø³Ù„Ø§Ù…ÙŠØ©',sections:['1Ù…1','2Ù…1','3Ù…1','4Ù…1'],hours:8,totalAssigned:0}
  ];

  renderTeachers();
  q('#showInstitutionName')?.remove(); // cleanup if exists
}

/* reset */
function resetAll(){
  teachers = []; renderTeachers();
  institution = { levels: {'1':0,'2':0,'3':0,'4':0}, name:'' };
  q('#institutionName').value=''; q('#lvl1').value=0; q('#lvl2').value=0; q('#lvl3').value=0; q('#lvl4').value=0;
  updateTotal();
  q('#outputArea').innerHTML='';
}

/* ===== scheduling algorithm (improved greedy + retries) ===== */
/*
 Approach:
 - Build list of classes from levels: e.g., '1Ù…1','1Ù…2',...
 - Build requirement per class: map subject->hours needed (from subjHours)
 - For each class, for each subject, attempt to place required hours into available day/slots
   - Prefer morning slots for Ø±ÙŠØ§Ø¶ÙŠØ§Øª
   - Avoid pedagogical day for subject
   - Ensure no more than 2 occurrences/day for same subject in class
   - Ensure teacher not double-booked and not exceed allowed hours (teacher.hours or MAX_TEACHER)
 - Retry several times with randomization and different ordering if conflicts
 - Place remedial (15:00-16:00) only when necessary
*/
function generateAll(){
  // read current institution levels
  institution.levels['1'] = parseInt(q('#lvl1').value||0);
  institution.levels['2'] = parseInt(q('#lvl2').value||0);
  institution.levels['3'] = parseInt(q('#lvl3').value||0);
  institution.levels['4'] = parseInt(q('#lvl4').value||0);
  institution.name = q('#institutionName').value || 'Ù…Ø¤Ø³Ø³Ø© Ù†Ù…ÙˆØ°Ø¬ÙŠØ©';

  // update pedagogical mapping from selects (if user changed)
  pedagogical['Ø±ÙŠØ§Ø¶ÙŠØ§Øª'] = q('#pdMath')?.value || pedagogical['Ø±ÙŠØ§Ø¶ÙŠØ§Øª'];
  pedagogical['Ø¹Ø±Ø¨ÙŠØ©'] = q('#pdArabic')?.value || pedagogical['Ø¹Ø±Ø¨ÙŠØ©'];
  pedagogical['ÙØ±Ù†Ø³ÙŠØ©'] = q('#pdFrench')?.value || pedagogical['ÙØ±Ù†Ø³ÙŠØ©'];
  pedagogical['Ø§Ù†Ø¬Ù„ÙŠØ²ÙŠØ©'] = q('#pdEng')?.value || pedagogical['Ø§Ù†Ø¬Ù„ÙŠØ²ÙŠØ©'];
  pedagogical['Ø¹Ù„ÙˆÙ… Ø·Ø¨ÙŠØ¹ÙŠØ©'] = q('#pdSci')?.value || pedagogical['Ø¹Ù„ÙˆÙ… Ø·Ø¨ÙŠØ¹ÙŠØ©'];
  pedagogical['ÙÙŠØ²ÙŠØ§Ø¡'] = q('#pdPhy')?.value || pedagogical['ÙÙŠØ²ÙŠØ§Ø¡'];

  // build sections list
  const sections = [];
  Object.entries(institution.levels).forEach(([lvl,cnt])=>{
    for(let i=1;i<=cnt;i++) sections.push(`${lvl}Ù…${i}`);
  });

  if(sections.length===0){ alert('Ù„Ù… ÙŠØªÙ… ØªØ¹Ø±ÙŠÙ Ø£ÙŠ Ù‚Ø³Ù…. Ø§Ø¶Ù Ø£Ù‚Ø³Ø§Ù…Ø§Ù‹ Ø£Ùˆ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¤Ø³Ø³ØªÙŠ.'); return; }
  if(teachers.length===0){ if(!confirm('Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø³Ø§ØªØ°Ø© ÙØ§Ø±ØºØ©. ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¤Ø³Ø³ØªÙŠØŸ')) { return; } loadMyCEM(); }

  // build class requirements
  const classReq = {}; // class -> { subj:remainingHours }
  sections.forEach(sec=>{
    const level = sec.charAt(0); // '1'..'4'
    classReq[sec] = {};
    for(const subj in subjHours){
      const hrs = subjHours[subj] && subjHours[subj][level] ? subjHours[subj][level] : 0;
      if(hrs>0) classReq[sec][subj] = hrs;
    }
    // rule: 4Ù… -> no Ø¥Ø¹Ù„Ø§Ù… Ø¢Ù„ÙŠ, add Ø±Ø³Ù… if not exists
    if(level==='4'){
      if(classReq[sec]['Ø¥Ø¹Ù„Ø§Ù… Ø¢Ù„ÙŠ']) delete classReq[sec]['Ø¥Ø¹Ù„Ø§Ù… Ø¢Ù„ÙŠ'];
      if(!classReq[sec]['Ø±Ø³Ù…']) classReq[sec]['Ø±Ø³Ù…']=1;
    }
  });

  // prepare teacher index by subject
  const teachersBySubject = {};
  teachers.forEach(t=>{
    if(!teachersBySubject[t.subject]) teachersBySubject[t.subject]=[];
    teachersBySubject[t.subject].push(t);
    t.totalAssigned = 0; // reset
  });

  // create schedule data structure
  const schedule = {}; // schedule[class][day][slot] = { subj, teacher, type }
  sections.forEach(sec=>{ schedule[sec]={}; DAYS.forEach(d=>{ schedule[sec][d] = {}; SLOTS.forEach(s=> schedule[sec][d][s]=null);} ); });

  // teacher busy map: teacherName -> day -> slot -> true/false
  const teacherBusy = {};
  teachers.forEach(t=>{ teacherBusy[t.name] = {}; DAYS.forEach(d=>{ teacherBusy[t.name][d] = {}; SLOTS.forEach(s=>teacherBusy[t.name][d][s]=false); }); });

  // helper utilities
  function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]] } return a; }
  function slotListForDay(day, preferMath=false){
    // order: morning (0..3), then afternoon (4..5), remedial(6)
    let arr = ['08:00-09:00','09:00-10:00','10:00-11:00','11:00-12:00','13:00-14:00','14:00-15:00','15:00-16:00'];
    if(day==='Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡'){ arr = arr.slice(0,4); } // Tuesday half-day
    if(preferMath){
      // prefer very first slots (08:00,09:00)
      arr = ['08:00-09:00','09:00-10:00','10:00-11:00','11:00-12:00','13:00-14:00','14:00-15:00','15:00-16:00'];
      if(day==='Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡') arr = arr.slice(0,4);
    }
    return arr;
  }

  // candidate teachers for subject & section (prefer those listing the section)
  function candidateTeachers(subj, section){
    const list = teachersBySubject[subj] ? teachersBySubject[subj].slice() : [];
    // rank: those who have the section appear first
    list.sort((a,b)=>{
      const aHas = a.sections && a.sections.includes(section);
      const bHas = b.sections && b.sections.includes(section);
      if(aHas && !bHas) return -1;
      if(!aHas && bHas) return 1;
      // then prefer lower assigned hours (load balancing)
      return (a.totalAssigned || 0) - (b.totalAssigned || 0);
    });
    return list;
  }

  // place hour attempt with checks
  function tryPlace(section, subj, day, slot, preferRemedial=false){
    // no scheduling on pedagogical day for subject
    if(pedagogical[subj] && pedagogical[subj]===day) return false;
    // don't place into break
    if(slot===BREAK_SLOT) return false;
    // class slot must be free
    if(schedule[section][day][slot]) return false;
    // Tuesday logic: if day is Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡ and slot index >=4 => disallowed
    if(day==='Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡'){
      const idx = SLOTS.indexOf(slot);
      if(idx>=4) return false;
    }
    // limit: same subject occurrences in the same day <=2
    const sameDayCount = SLOTS.reduce((acc,s)=> acc + (schedule[section][day][s] && schedule[section][day][s].subj===subj ? 1:0), 0);
    if(sameDayCount>=2) return false;
    // try to find teacher
    const cands = candidateTeachers(subj, section);
    for(const cand of cands){
      // teacher must not exceed assigned allowed hours (cand.hours & global MAX)
      if((cand.totalAssigned||0) >= cand.hours) continue;
      if((cand.totalAssigned||0) >= MAX_TEACHER) continue;
      // teacher must be free at that slot across all classes
      if(teacherBusy[cand.name][day][slot]) continue;
      // all good -> assign
      schedule[section][day][slot] = {subj, teacher: cand.name, type: preferRemedial ? 'remedial' : 'official'};
      cand.totalAssigned = (cand.totalAssigned||0) + 1;
      teacherBusy[cand.name][day][slot] = true;
      return true;
    }
    return false;
  }

  // main greedy with retries
  const MAX_ATTEMPTS = 10;
  let attempt=0, success=false;
  while(attempt<MAX_ATTEMPTS && !success){
    attempt++;
    // reset schedule and teacher assignments
    sections.forEach(sec=>{ DAYS.forEach(d=> SLOTS.forEach(s=> schedule[sec][d][s] = null)); });
    teachers.forEach(t=> t.totalAssigned = 0);
    teachers.forEach(t=> DAYS.forEach(d=> SLOTS.forEach(s=> teacherBusy[t.name][d][s]=false)));
    // order of classes randomized to vary solutions
    const classOrder = shuffle(sections.slice());
    let failed=false;

    for(const section of classOrder){
      const level = section.charAt(0);
      // build subject list sorted by descending hours to place heavy subjects first
      const subjects = Object.keys(classReq[section] || {}).sort((a,b)=> (classReq[section][b] - classReq[section][a]));
      for(const subj of subjects){
        let remaining = classReq[section][subj];
        let placeTrials = 0;
        while(remaining>0){
          placeTrials++;
          if(placeTrials>500){ failed=true; break; }
          // choose days order randomized but respecting preferences
          const daysPool = shuffle(DAYS.slice());
          let placed=false;
          for(const day of daysPool){
            // skip pedagogical day
            if(pedagogical[subj] && pedagogical[subj]===day) continue;
            // choose slots (prefer morning for math)
            const preferMath = (subj==='Ø±ÙŠØ§Ø¶ÙŠØ§Øª');
            const slotsPool = slotListForDay(day, preferMath);
            // try prioritized slots
            for(const slot of slotsPool){
              // skip break and remedial conditions
              if(slot===BREAK_SLOT) continue;
              if(slot==='15:00-16:00'){
                // remedial slot: allow but deprioritize
                if(Math.random()>0.5) continue;
              }
              // try place
              if(tryPlace(section, subj, day, slot, slot==='15:00-16:00')) { remaining--; placed=true; break; }
            }
            if(placed) break;
          } // end daysPool
          if(!placed){
            // try remedial slot more aggressively across days (except pedagogical and Tuesday)
            let remedialPlaced=false;
            for(const day of DAYS){
              if(pedagogical[subj] && pedagogical[subj]===day) continue;
              if(day==='Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡') continue;
              const slot = '15:00-16:00';
              if(tryPlace(section, subj, day, slot, true)){ remaining--; remedialPlaced=true; break; }
            }
            if(!remedialPlaced){
              failed=true; break;
            }
          }
        } // end placing remaining
        if(failed) break;
      } // end subjects
      if(failed) break;
    } // end classOrder

    // final check: no teacher exceeds MAX_TEACHER and class requirements filled
    const over = teachers.some(t=> (t.totalAssigned||0) > MAX_TEACHER );
    // check all class requirements satisfied
    let allSatisfied = true;
    for(const sec of sections){
      for(const subj in classReq[sec]){
        // count occurrences in schedule
        const count = DAYS.reduce((acc,d)=> acc + SLOTS.reduce((a,s)=> a + (schedule[sec][d][s] && schedule[sec][d][s].subj===subj ? 1:0), 0), 0);
        if(count < classReq[sec][subj]) { allSatisfied=false; break; }
      }
      if(!allSatisfied) break;
    }

    if(!failed && !over && allSatisfied){
      success=true; break;
    }
    // else retry loop for a different randomized order
  } // end attempts

  if(!success){
    alert('Ø­Ø§ÙˆÙ„Øª ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø¹Ø¯Ø© Ù…Ø±Ø§Øª ÙˆÙ„Ù… Ø£Ø¬Ø¯ Ø­Ù„Ù‹Ø§ ÙƒØ§Ù…Ù„Ø§Ù‹ Ø«Ø§Ø¨ØªÙ‹Ø§. Ø£Ø¹Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø£Ùˆ Ø±Ø§Ø¬Ø¹ ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø£Ø³Ø§ØªØ°Ø©/Ø§Ù„Ø³Ø§Ø¹Ø§Øª.');
  }
  // render whatever schedule computed (maybe partial)
  renderResult(schedule, sections);
}

/* ===== render output ===== */
function renderResult(schedule, sections){
  const out = q('#outputArea'); out.innerHTML='';

  // Institution header
  const instCard = document.createElement('div'); instCard.className='card';
  let html = `<h3>ğŸ“‹ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø¤Ø³Ø³Ø© â€” ${institution.name}</h3>`;
  html += `<div class="small">Ø§Ù„Ø£Ù‚Ø³Ø§Ù…: ${sections.join(', ')}</div>`;
  instCard.innerHTML = html;
  out.appendChild(instCard);

  // Detailed institution view: for each day show compact table with classes columns
  const instTableCard = document.createElement('div'); instTableCard.className='card';
  let instHTML = '<h4>Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø¤Ø³Ø³Ø© (Ø§Ù„ÙŠÙˆÙ… Ã— Ø§Ù„Ø³Ø§Ø¹Ø© Ã— Ø§Ù„Ù‚Ø³Ù…)</h4>';
  for(const day of DAYS){
    instHTML += `<h5 style="margin:6px 0">${day}</h5><table class="schedule-table"><tr><th>Ø§Ù„Ø³Ø§Ø¹Ø©</th>`;
    sections.forEach(sec=> instHTML += `<th class="slot">${sec}</th>`);
    instHTML += '</tr>';
    SLOTS.forEach(slot=>{
      instHTML += `<tr><td>${slot}</td>`;
      sections.forEach(sec=>{
        const cell = schedule[sec][day][slot];
        if(cell){
          const cls = cell.type==='remedial' ? 'remedial' : 'official';
          instHTML += `<td class="${cls}">${cell.subj}<br/><span class="small">${cell.teacher}</span></td>`;
        } else {
          if(slot===SLOTS[4] && slot==='13:00-14:00'){} // keep formatting
          if(slot==='13:00-14:00') instHTML += `<td class="break">Ø±Ø§Ø­Ø©</td>`;
          else if(day==='Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡' && SLOTS.indexOf(slot)>=4) instHTML += `<td class="free">â€”</td>`;
          else instHTML += `<td class="free">ÙØ±Ø§Øº</td>`;
        }
      });
      instHTML += `</tr>`;
    });
    instHTML += `</table>`;
  }
  instTableCard.innerHTML = instHTML;
  out.appendChild(instTableCard);

  // Students schedules per class
  const studentsCard = document.createElement('div'); studentsCard.className='card';
  let studsHTML = '<h4>Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„ØªÙ„Ø§Ù…ÙŠØ° Ù„ÙƒÙ„ Ù‚Ø³Ù…</h4>';
  sections.forEach(sec=>{
    studsHTML += `<h5 style="margin:6px 0">${sec}</h5><table class="schedule-table"><tr><th>Ø§Ù„Ø³Ø§Ø¹Ø©</th>`;
    DAYS.forEach(d=> studsHTML += `<th>${d}</th>`);
    studsHTML += '</tr>';
    SLOTS.forEach(slot=>{
      studsHTML += `<tr><td>${slot}</td>`;
      DAYS.forEach(day=>{
        const cell = schedule[sec][day][slot];
        if(cell){
          const cls = (cell.type==='remedial') ? 'remedial' : 'official';
          studsHTML += `<td class="${cls}">${cell.subj}<br/><span class="small">${cell.teacher}</span></td>`;
        } else {
          if(slot==='13:00-14:00') studsHTML += `<td class="break">Ø±Ø§Ø­Ø©</td>`;
          else if(day==='Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡' && SLOTS.indexOf(slot)>=4) studsHTML += `<td class="free">â€”</td>`;
          else studsHTML += `<td class="free">ÙØ±Ø§Øº</td>`;
        }
      });
      studsHTML += '</tr>';
    });
    studsHTML += '</table>';
  });
  studentsCard.innerHTML = studsHTML;
  out.appendChild(studentsCard);

  // Teachers schedules
  const teachCard = document.createElement('div'); teachCard.className='card';
  let teachHTML = '<h4>Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ø£Ø³Ø§ØªØ°Ø©</h4>';
  teachers.forEach(t=>{
    teachHTML += `<h5 style="margin:6px 0">${t.name} â€” ${t.subject} (Ø³Ø§Ø¹Ø§Øª Ù…Ø³Ø¬Ù„Ø©: ${t.totalAssigned||0}/${t.hours})</h5><table class="schedule-table"><tr><th>Ø§Ù„Ø³Ø§Ø¹Ø©</th>`;
    DAYS.forEach(d=> teachHTML += `<th>${d}</th>`);
    teachHTML += '</tr>';
    SLOTS.forEach(slot=>{
      teachHTML += `<tr><td>${slot}</td>`;
      DAYS.forEach(day=>{
        // find class where teacher teaches at that slot
        let found = null;
        for(const sec of sections){
          const c = schedule[sec][day][slot];
          if(c && c.teacher===t.name){ found = {sec,c}; break; }
        }
        if(found){
          const cls = (found.c.type==='remedial') ? 'remedial' : 'official';
          teachHTML += `<td class="${cls}">${found.sec}<br/><span class="small">${found.c.subj}</span></td>`;
        } else {
          if(slot==='13:00-14:00') teachHTML += `<td class="break">Ø±Ø§Ø­Ø©</td>`;
          else if(day==='Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡' && SLOTS.indexOf(slot)>=4) teachHTML += `<td class="free">â€”</td>`;
          else teachHTML += `<td class="free">ÙØ±Ø§Øº</td>`;
        }
      });
      teachHTML += `</tr>`;
    });
    teachHTML += `</table>`;
  });
  teachCard.innerHTML = teachHTML;
  out.appendChild(teachCard);

  // success message
  setTimeout(()=> window.scrollTo({ top: out.offsetTop - 20, behavior: 'smooth' }), 100);
}

/* copy and export (basic) */
function copyOutput(){
  const html = q('#outputArea').innerHTML;
  navigator.clipboard.writeText(html).then(()=> alert('ØªÙ… Ù†Ø³Ø® Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ (HTML)'));
}
async function exportPDF(){
  if(!window.html2canvas || !window.jspdf){ alert('ÙŠØªØ·Ù„Ø¨ html2canvas Ùˆ jsPDF (CDN). ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.'); return; }
  const el = q('#outputArea');
  const canvas = await html2canvas(el, {scale:1.2, useCORS:true, backgroundColor:'#071018'});
  const imgData = canvas.toDataURL('image/png');
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF('l','mm','a4');
  const pdfW = pdf.internal.pageSize.getWidth();
  const imgProps = pdf.getImageProperties(imgData);
  const pdfH = (imgProps.height * pdfW) / imgProps.width;
  pdf.addImage(imgData,'PNG',0,0,pdfW,pdfH);
  pdf.save('schedule.pdf');
}

/* utility to load earlier sample if user didn't add teachers */
function loadMyCEM(){
  loadMyCEM(); // call the earlier loader
}

/* initial UI setup */
updateTotal();
renderTeachers();

/* include external libs for PDF via script tags are appended at end of file */
</script>

<!-- include html2canvas and jsPDF CDN for PDF export -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</body>
</html>
